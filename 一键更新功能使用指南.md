# 一键更新功能使用指南

## 🎯 功能概述

一键更新功能已成功集成到应用中，用户可以通过设置页面轻松检查和更新应用及AI模型。

## 🚀 如何使用

### 1. 打开更新界面
1. 启动应用
2. 进入 **设置** 页面
3. 点击 **"一键更新"** 选项

### 2. 检查更新
- 系统会自动检查应用和模型更新
- 显示当前状态和可用更新

### 3. 执行更新
- **单独更新**: 选择更新应用或特定模型
- **全部更新**: 一键更新所有可用内容
- **自动备份**: 更新前自动创建备份

## 📱 界面功能

### 更新状态显示
- 🔵 **蓝色**: 正在检查更新
- 🟠 **橙色**: 发现可用更新
- 🟢 **绿色**: 已是最新版本
- 🔴 **红色**: 更新失败

### 进度条
- 实时显示下载进度
- 支持断点续传
- 显示下载速度和剩余时间

### 更新选项
- **应用更新**: 更新主程序
- **模型更新**: 更新AI模型
- **全部更新**: 批量更新所有内容

## ⚙️ 配置说明

### 更新配置文件 (update_config.json)
```json
{
  "version_url": "https://your-cdn.com/version.json",
  "app_name": "Aithon",
  "current_version": "0.1.0",
  "update_check_interval": 3600,
  "auto_download": false,
  "backup_before_update": true,
  "mirror_urls": [
    "https://mirror1.example.com/",
    "https://mirror2.example.com/"
  ]
}
```

### 配置项说明
- `version_url`: 版本信息获取地址
- `current_version`: 当前应用版本
- `auto_download`: 是否自动下载更新
- `backup_before_update`: 更新前是否创建备份
- `mirror_urls`: 镜像下载地址列表

## 🔧 开发者配置

### 1. 设置更新源
```python
from src.utils.UpdateManager import update_manager

# 配置更新源
update_manager.update_config.update({
    "version_url": "https://your-cdn.com/version.json",
    "current_version": "0.1.0"
})

# 保存配置
update_manager.save_config()
```

### 2. 构建更新包
```bash
# 构建完整更新包
python -m src.utils.UpdateBuilder ./app 1.2.0 --changelog "新增功能"

# 构建增量更新包
python -m src.utils.UpdateBuilder ./app 1.2.0 --previous 1.1.0
```

### 3. 部署更新源
将构建的更新包上传到CDN，并配置 `version.json` 文件。

## 🛠️ 测试功能

### 运行测试脚本
```bash
# 测试更新系统
python test_update_system.py
```

### 测试内容
- ✅ UpdateBuilder 功能测试
- ✅ UpdateManager 功能测试
- ✅ UI界面测试
- ✅ 模拟更新流程

## 📊 功能特性

### 智能更新
- 🔍 **自动检测**: 启动时自动检查更新
- 📦 **增量更新**: 只下载变化的文件
- 🔄 **断点续传**: 支持下载中断后继续
- 🪞 **多镜像**: 支持多个下载源

### 安全可靠
- 🔒 **文件验证**: 下载后验证文件完整性
- 💾 **自动备份**: 更新前创建备份
- 🚫 **权限控制**: 安全的文件操作
- 🔐 **HTTPS**: 安全的网络传输

### 用户体验
- 📱 **直观界面**: 简洁易用的更新界面
- 📈 **实时进度**: 显示详细的下载进度
- ⚡ **快速响应**: 异步处理，不阻塞界面
- 🎯 **一键操作**: 简化更新流程

## 🚨 注意事项

### 更新前准备
1. **网络连接**: 确保网络连接稳定
2. **存储空间**: 确保有足够的存储空间
3. **应用关闭**: 更新时建议关闭其他应用

### 故障处理
1. **下载失败**: 检查网络连接，尝试使用镜像源
2. **验证失败**: 重新下载文件
3. **更新失败**: 从备份恢复

### 备份恢复
```python
# 从备份恢复
update_manager.restore_from_backup("backup/backup_20250115_103000")
```

## 📈 性能优化

### 下载优化
- **并行下载**: 大文件分块并行下载
- **智能重试**: 失败后自动重试
- **带宽控制**: 可配置下载速度限制

### 存储优化
- **增量更新**: 只下载变化的文件
- **压缩传输**: 使用压缩减少传输量
- **缓存机制**: 避免重复下载

## 🔮 未来计划

### 即将推出
- [ ] 自动更新检查
- [ ] 更新通知系统
- [ ] 版本回滚功能
- [ ] 更新日志查看

### 长期规划
- [ ] 增量模型更新
- [ ] 云端配置同步
- [ ] 多语言支持
- [ ] 更新统计分析

---

## 🎉 总结

一键更新功能为应用提供了完整的更新解决方案，支持：
- ✅ 应用和模型的一键更新
- ✅ 智能的增量更新机制
- ✅ 可靠的备份和恢复
- ✅ 优秀的用户体验

现在用户可以轻松保持应用和AI模型的最新状态，享受最佳的使用体验！
